<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Read Later</title>
    <style>
        body {
            font-family: Verdana, Arial, sans-serif;
            font-size: 11px;
            margin: 20px;
            background: #fff;
            color: #333;
            line-height: 1.4;
        }
        
        h1 {
            font-size: 16px;
            margin: 0 0 20px 0;
            font-weight: normal;
        }
        
        .article {
            margin-bottom: 12px;
            padding-bottom: 8px;
        }
        
        .article-link {
            color: #00c;
            text-decoration: underline;
            font-size: 11px;
        }
        
        .article-link:visited {
            color: #551a8b;
        }
        
        .article-link:hover {
            text-decoration: none;
        }
        
        .article-description {
            color: #666;
            margin: 2px 0;
            font-size: 11px;
        }
        
        .article-tags {
            font-size: 10px;
            color: #999;
        }
        
        .article-tags a {
            color: #999;
            text-decoration: none;
            margin-right: 8px;
        }
        
        .article-tags a:hover {
            text-decoration: underline;
        }
        
        .date {
            color: #999;
            font-size: 10px;
            margin-right: 8px;
        }
        
        .loading {
            color: #666;
            font-style: italic;
        }
        
        .error {
            color: #c00;
            font-style: italic;
        }
    </style>
</head>
<body>
    <h1>Read Later</h1>
    <div id="articles">
        <div class="loading">Loading articles...</div>
    </div>

    <script>
        async function loadArticles() {
            const articlesDiv = document.getElementById('articles');
            
            try {
                const response = await fetch('articles.md');
                const text = await response.text();
                
                if (!response.ok) {
                    throw new Error('Failed to load articles');
                }
                
                const articles = parseMarkdown(text);
                displayArticles(articles);
                
            } catch (error) {
                articlesDiv.innerHTML = '<div class="error">Error loading articles. Make sure articles.md exists in your repository.</div>';
            }
        }
        
        function parseMarkdown(text) {
            const articles = [];
            const lines = text.split('\n');
            let currentArticle = null;
            
            for (let line of lines) {
                line = line.trim();
                
                // Skip empty lines and headers
                if (!line || line.startsWith('#')) continue;
                
                // Check if line starts with a link
                const linkMatch = line.match(/^\[(.+?)\]\((.+?)\)(.*)$/);
                if (linkMatch) {
                    // Save previous article if exists
                    if (currentArticle) {
                        articles.push(currentArticle);
                    }
                    
                    // Start new article
                    currentArticle = {
                        title: linkMatch[1],
                        url: linkMatch[2],
                        description: linkMatch[3].trim(),
                        tags: [],
                        date: null
                    };
                } else if (currentArticle) {
                    // Check for tags line
                    if (line.startsWith('Tags:') || line.startsWith('tags:')) {
                        const tagsText = line.substring(5).trim();
                        currentArticle.tags = tagsText.split(',').map(tag => tag.trim()).filter(tag => tag);
                    }
                    // Check for date line
                    else if (line.startsWith('Date:') || line.startsWith('date:')) {
                        currentArticle.date = line.substring(5).trim();
                    }
                    // Additional description
                    else if (line && !line.startsWith('---')) {
                        if (currentArticle.description) {
                            currentArticle.description += ' ' + line;
                        } else {
                            currentArticle.description = line;
                        }
                    }
                }
            }
            
            // Don't forget the last article
            if (currentArticle) {
                articles.push(currentArticle);
            }
            
            return articles;
        }
        
        function displayArticles(articles) {
            const articlesDiv = document.getElementById('articles');
            
            if (articles.length === 0) {
                articlesDiv.innerHTML = '<div class="error">No articles found. Add some links to your articles.md file!</div>';
                return;
            }
            
            let html = '';
            for (let article of articles) {
                html += '<div class="article">';
                
                // Date
                if (article.date) {
                    html += `<span class="date">${article.date}</span>`;
                }
                
                // Link
                html += `<a href="${article.url}" class="article-link" target="_blank">${article.title}</a><br>`;
                
                // Description
                if (article.description) {
                    html += `<div class="article-description">${article.description}</div>`;
                }
                
                // Tags
                if (article.tags.length > 0) {
                    html += '<div class="article-tags">';
                    for (let tag of article.tags) {
                        html += `<a href="#" onclick="filterByTag('${tag}')">${tag}</a>`;
                    }
                    html += '</div>';
                }
                
                html += '</div>';
            }
            
            articlesDiv.innerHTML = html;
        }
        
        function filterByTag(tag) {
            // Simple tag filtering - you can enhance this
            alert(`Filtering by tag: ${tag} (feature not implemented yet)`);
        }
        
        // Load articles when page loads
        loadArticles();
    </script>
</body>
</html>
